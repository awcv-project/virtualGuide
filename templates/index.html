<!DOCTYPE html>
<html>
<head>
  <title>Virtual Guide</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      padding: 20px;
    }
    h1 {
      margin-bottom: 20px;
    }
    .container {
      max-width: 400px;
    }
    .btn-group {
      margin-bottom: 20px;
    }
    #status {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Virtual Guide</h1>
    <div class="form-group">
      <label for="languageDropdown">Select language</label>
      <select class="form-control" id="languageDropdown">
        <option value="">Select language</option>
        <option value="tamil">Tamil</option>
        <option value="english">English</option>
        <option value="kannada">Kannada</option>
        <option value="marathi">Marathi</option>
        <option value="hindi">Hindi</option>
        <option value="telugu">Telugu</option>
        <option value="gujarati">Gujarati</option>
      </select>
    </div>
    <div class="form-group">
      <label for="targetlanguageDropdown">Select target language</label>
      <select class="form-control" id="targetlanguageDropdown">
        <option value="">Select target language</option>
        <option value="tamil">Tamil</option>
        <option value="english">English</option>
        <option value="kannada">Kannada</option>
        <option value="marathi">Marathi</option>
        <option value="hindi">Hindi</option>
        <option value="telugu">Telugu</option>
        <option value="gujarati">Gujarati</option>
      </select>
    </div>
    <div class="btn-group">
      <button class="btn btn-primary" id="startBtn" onclick="startRecording()">Start Recording</button>
      <button class="btn btn-danger" id="stopBtn" onclick="stopRecording()">Stop Recording</button>
      <button class="btn btn-success" id="sendBtn" onclick="sendAudio()">Get Response</button>
    </div>
  </div>
  <div id="status"></div>

  <script src="https://cdn.socket.io/4.3.1/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    // Your existing JavaScript code here
  </script>
</body>
</html>

<script src="https://cdn.socket.io/4.3.1/socket.io.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>

    let mediaRecorder;
    let chunks = [];
    let selectedLanguage;
    let selectedTargetLanguage;

    const socket = io();

    socket.on('connect', () => {
        console.log('Connected to server');
    });

    socket.on('response', function(response) {
        $('#status').append('<p>' + response + '</p>');
    });

function startRecording() {
  navigator.mediaDevices.getUserMedia({ audio: true })
    .then(function(stream) {
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();

      mediaRecorder.addEventListener("dataavailable", function(e) {
        chunks.push(e.data);
      });
    })
    .catch(function(err) {
      console.log("Unable to access microphone: " + err);
    });
}

function stopRecording() {
  mediaRecorder.stop();
}

function sendAudio() {
  if (chunks.length === 0) {
    console.log("No recorded audio available.");
    return;
  }

  const blob = new Blob(chunks, { type: "audio/webm" });

  const formData = new FormData();
  formData.append("audio", blob);
  formData.append("language", selectedLanguage);
  formData.append("target_language", selectedTargetLanguage);

  fetch("/play_voice", {
    method: "POST",
    body: formData
  })
  .then(function(response) {
    console.log("Audio sent successfully!");
    chunks = [];
  })
  .catch(function(error) {
    console.error("Error sending audio: " + error);
  });
}

document.getElementById("languageDropdown").addEventListener("change", function() {
  selectedLanguage = this.value;
});

document.getElementById("targetlanguageDropdown").addEventListener("change", function() {
    selectedTargetLanguage = this.value;
  });

</script>
